<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">All Films</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/history.css">
    <style>
        .close-link {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: white;
            color: black;
            border-radius: 30%;
            width: 24px;
            height: 24px;
            font-size: 16px;
            text-align: center;
            line-height: 24px;
            text-decoration: none;
            z-index: 10;
        }

        .close-link:hover {
            background-color: rgba(255, 0, 0, 0.8);
        }
    </style>
</head>

<!-- Navbar -->
<div th:insert="fragments/navbar :: navbar"></div>

<div id="wrapper" class="account-wrap">
    <div class="dashboard-container">
        <div th:insert="fragments/profilesidebar :: sidebar"></div>
        <div class="dcc-main">
            <div class="cg-body-box py-0 is-profile">

                <div class="box-body">

                    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-5 gx-4 gy-4">
                        <div class="col" th:each="history : ${historyList}">
                            <a th:href="@{|/mediaVideo/${#strings.replace(history.media.title.toLowerCase(), ' ', '-')}.${history.media.id}${history.episode != null ? '?ep=' + history.episode.episodeNumber : '?ep=1'}|}"
                               style="text-decoration: none; color: inherit;">
                                <div class="card bg-dark border-0 h-100 text-white text-center"
                                     style="transition: transform 0.2s;">
                                    <img th:src="${history.media.poster}" class="card-img-top" alt="Movie Poster"
                                         style="height: 350px; object-fit: cover; border-radius: 8px;">
                                    <div class="card-body p-2">
                                        <a th:href="@{/history/delete/{id}(id=${history.getMedia().getId()})}" class="close-link fa-solid fa-times"></a>
                                        <h6 class="card-title mb-1" th:text="${history.media.title}">Movie Title</h6>
                                        <!--                                        <small class="text"-->
                                        <!--                                               th:text="${#lists.size(history.media.genres) >= 2-->
                                        <!--                    ? history.media.genres[0].name + ', ' + history.media.genres[1].name + ' | ' + history.media.releaseYear-->
                                        <!--                    : #lists.size(history.media.genres) == 1-->
                                        <!--                    ? history.media.genres[0].name + ' | ' + history.media.releaseYear-->
                                        <!--                    : 'Unknown | ' + history.media.releaseYear}">-->
                                        <!--                                            Genre | Year-->
                                        <!--                                        </small>-->
                                        <small class="episode-info"
                                               th:text="${history.episode!= null ?'Episode ' + history.episode.episodeNumber : 'Movies'}">
                                        </small>

                                        <br>
<!--                                        Watched at-->
<!--                                        <th:block-->
<!--                                                th:with="watchedDate=${T(java.util.Date).from(history.watchedAt.atZone(T(java.time.ZoneId).systemDefault()).toInstant())}">-->
<!--                                            <small th:text="${#dates.format(watchedDate, 'dd-MM-yyyy HH:mm')}"></small>-->
<!--                                        </th:block>-->

                                    </div>
                                </div>
                            </a>
                        </div>

                    </div>

                </div>
            </div>
        </div>

    </div>
</div>
<!-- Footer -->
<div th:insert="fragments/footer :: footer"></div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const currentPath = window.location.pathname;
        const menuItems = document.querySelectorAll(".menu-user .item");

        menuItems.forEach(item => {
            if (item.getAttribute("href") === currentPath) {
                item.classList.add("active");
            }
        });
    });
</script>
</html>
